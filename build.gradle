plugins {
    id 'java'
    id 'java-library'
    id 'idea'
    id "maven-publish"
    id 'com.gradleup.shadow' version '8.3.6'
}

group = 'at.ac.tuwien.ifs.sge'
version = '1.0.4'

java {
    sourceCompatibility = JavaVersion.VERSION_11
}

repositories {
    mavenCentral()
}

dependencies {

    implementation("info.picocli:picocli:4.7.0")
    implementation("com.google.guava:guava:31.1-jre")
    testImplementation("junit:junit:4.13.2")
}

jar {
    manifest {
        attributes("Main-Class": "at.ac.tuwien.ifs.sge.engine.cli.SgeCommand")
    }
}

java {
    withJavadocJar()
    withSourcesJar()
}

shadowJar {
    archiveClassifier.set('exe')
}

javadoc {
    if (JavaVersion.current().isJava9Compatible()) {
        options.addBooleanOption('html5', true)
    }
}

test {
    useJUnit()
    maxHeapSize = '1G'
}

tasks.register('generateVersionsYaml') {
    description = 'Generate versions.yaml file with project metadata'
    group = 'Documentation'

    doLast {
        def versionsFile = file('manual/versions.yaml')
        versionsFile.parentFile.mkdirs()

        def yaml = """
# Automatically generated from Gradle properties
SGE_VERSION: ${project.version}
JAVA_VERSION: ${project.sourceCompatibility}
""".trim()

        versionsFile.text = yaml
        println "Generated ${versionsFile.absolutePath}"
    }
}
